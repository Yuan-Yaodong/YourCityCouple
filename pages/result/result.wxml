<!--pages/result/result.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{!showResult}}" class="loading">
    <text>æ­£åœ¨è®¡ç®—ä½ çš„è¿åŠ¿...</text>
  </view>

  <!-- ç»“æœå†…å®¹ -->
  <view wx:else class="result-content">
    <!-- é¡¶éƒ¨è£…é¥° -->
    <view class="top-decor {{showAnimations ? 'fade-in' : ''}}">
      <text>ğŸ§§</text>
      <text>ğŸŠ</text>
      <text>ğŸ®</text>
    </view>

    <!-- ç»“æœæ ‡é¢˜ -->
    <view class="result-header {{showAnimations ? 'slide-up' : ''}}" style="animation-delay: 0.2s">
      <text class="result-label">ä½ çš„å¼€å¹´æ—ºåŸæ˜¯</text>
      <text class="result-emoji">{{cityDetail.emoji}}</text>
      <text class="result-city">{{result.city}}</text>
    </view>

    <!-- åŸå¸‚æè¿° -->
    <view class="city-card {{showAnimations ? 'slide-up' : ''}}" style="animation-delay: 0.4s">
      <text class="city-desc">{{cityDetail.description}}</text>

      <!-- æ ‡ç­¾ -->
      <view class="tags">
        <text wx:for="{{cityDetail.tags}}" wx:key="index" class="tag {{showAnimations ? 'fade-in' : ''}}" style="animation-delay: {{0.6 + index * 0.15}}s">
          {{item}}
        </text>
      </view>

      <!-- è¯¦ç»†ä»‹ç» -->
      <text class="city-detail {{showAnimations ? 'fade-in' : ''}}" style="animation-delay: {{0.6 + cityDetail.tags.length * 0.15}}s">{{cityDetail.detail}}</text>

      <!-- åˆ†ææ–‡æ¡ˆ -->
      <view wx:if="{{analysis}}" class="analysis-section {{showAnimations ? 'slide-up' : ''}}" style="animation-delay: {{0.6 + (cityDetail.tags.length + 1) * 0.15}}s">
        <view class="analysis-title">ä¸ºä»€ä¹ˆé€‚åˆä½ </view>
        <view class="analysis-item" wx:for="{{analysis.whyFit}}" wx:key="index">
          <text class="analysis-point">{{item.text}}</text>
          <text class="analysis-desc">{{item.desc}}</text>
        </view>
        <view class="analysis-summary">{{analysis.summary}}</view>
      </view>

      <!-- MBTIäººæ ¼å¡ç‰‡ -->
      <view wx:if="{{mbti}}" class="mbti-card {{showAnimations ? 'slide-up' : ''}}" style="animation-delay: {{0.7 + (cityDetail.tags.length + 1) * 0.15}}s">
        <view class="mbti-header">
          <text class="mbti-emoji">{{mbti.emoji}}</text>
          <view class="mbti-title-wrap">
            <text class="mbti-type">{{mbti.type}}</text>
            <text class="mbti-name">{{mbti.name}}</text>
          </view>
        </view>
        <text class="mbti-desc">{{mbti.description}}</text>
        <view class="mbti-travel">
          <text class="mbti-travel-label">æ—…è¡Œé£æ ¼</text>
          <text class="mbti-travel-text">{{mbti.travelStyle}}</text>
        </view>
      </view>

      <!-- äº”è¡Œå±æ€§å¡ç‰‡ -->
      <view wx:if="{{fiveElement}}" class="five-element-card {{showAnimations ? 'slide-up' : ''}}" style="animation-delay: {{0.8 + (cityDetail.tags.length + 1) * 0.15}}s">
        <view class="five-element-header">
          <text class="five-element-emoji">{{fiveElement.detail.emoji}}</text>
          <text class="five-element-title">ä½ çš„äº”è¡Œå±æ€§</text>
        </view>
        <view class="five-element-name">{{fiveElement.detail.name}}å±</view>
        <view class="five-element-info">
          <view class="five-element-item">
            <text class="five-element-label">å¹¸è¿è‰²</text>
            <text class="five-element-value">{{fiveElement.detail.luckyColors.join('ã€')}}</text>
          </view>
          <view class="five-element-item">
            <text class="five-element-label">å¹¸è¿æ•°å­—</text>
            <text class="five-element-value">{{fiveElement.detail.luckyNumbers.join('ã€')}}</text>
          </view>
          <view class="five-element-item">
            <text class="five-element-label">è´µäººæ–¹ä½</text>
            <text class="five-element-value">{{fiveElement.detail.direction}}</text>
          </view>
        </view>
        <text class="five-element-fortune">{{fiveElement.detail.fortune}}</text>
      </view>

      <!-- ä¸“å±ç§°å· -->
      <view wx:if="{{cityDetail.title}}" class="title-card {{showAnimations ? 'slide-up' : ''}}" style="animation-delay: {{0.9 + (cityDetail.tags.length + 1) * 0.15}}s">
        <view class="title-label">ä½ çš„ä¸“å±ç§°å·</view>
        <view class="title-name">{{cityDetail.title}}</view>
      </view>

      <!-- æ²»æ„ˆè¯­å½• -->
      <view wx:if="{{cityDetail.healing}}" class="healing-card {{showAnimations ? 'fade-in' : ''}}" style="animation-delay: 1s">
        <view class="healing-icon">ğŸ’</view>
        <text class="healing-text">{{cityDetail.healing}}</text>
      </view>

      <!-- å¹¸è¿å…ƒç´  -->
      <view wx:if="{{cityDetail.luckyColor || cityDetail.luckyNumber || cityDetail.luckyThing}}" class="lucky-card {{showAnimations ? 'slide-up' : ''}}" style="animation-delay: {{1.1 + (cityDetail.tags.length + 1) * 0.15}}s">
        <view class="lucky-title">æ–°å¹´å¹¸è¿å…ƒç´ </view>
        <view class="lucky-items">
          <view wx:if="{{cityDetail.luckyColor}}" class="lucky-item">
            <text class="lucky-label">å¹¸è¿è‰²</text>
            <text class="lucky-value">{{cityDetail.luckyColor}}</text>
          </view>
          <view wx:if="{{cityDetail.luckyNumber}}" class="lucky-item">
            <text class="lucky-label">å¹¸è¿æ•°å­—</text>
            <text class="lucky-value">{{cityDetail.luckyNumber}}</text>
          </view>
          <view wx:if="{{cityDetail.luckyThing}}" class="lucky-item">
            <text class="lucky-label">å¹¸è¿ç‰©</text>
            <text class="lucky-value">{{cityDetail.luckyThing}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æŒ‰é’®åŒºåŸŸ -->
    <view class="btn-area {{showAnimations ? 'slide-up' : ''}}" style="animation-delay: 0.8s">
      <button class="btn-share" bindtap="generatePoster">
        ğŸ–¼ï¸ ç”Ÿæˆæµ·æŠ¥
      </button>
      <button class="btn-copy" bindtap="copyResult">
        ğŸ“¤ åˆ†äº«ç»™æœ‹å‹
      </button>
      <button class="btn-restart" bindtap="restartTest">
        ğŸ”„ å†æµ‹ä¸€æ¬¡
      </button>
    </view>

    <!-- åº•éƒ¨è£…é¥° -->
    <view class="bottom-decor {{showAnimations ? 'fade-in' : ''}}" style="animation-delay: 1s">
      <text>ğŸ‡</text>
      <text>âœ¨</text>
      <text>ğŸ†</text>
    </view>
  </view>

  <!-- æµ·æŠ¥é¢„è§ˆå¼¹çª— -->
  <view class="poster-modal" wx:if="{{showPosterModal}}" bindtap="closePosterModal">
    <view class="poster-content" catchtap="preventClose">
      <image class="poster-image" src="{{posterImage}}" mode="widthFix"></image>
      <button class="btn-save" bindtap="savePosterToAlbum">ä¿å­˜åˆ°ç›¸å†Œ</button>
      <view class="close-hint">ç‚¹å‡»ç©ºç™½å¤„å…³é—­</view>
    </view>
  </view>

  <!-- éšè—çš„canvasç”¨äºç”Ÿæˆæµ·æŠ¥ -->
  <canvas canvas-id="posterCanvas" class="hide-canvas"></canvas>
</view>
